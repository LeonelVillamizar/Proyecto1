<div class="row">
    <div class="col-12">
        <div class="page-title-box d-sm-flex align-items-center justify-content-between">
            <h4 class="mb-sm-0 font-size-18">Editar</h4>

            <div class="page-title-right">
                <ol class="breadcrumb m-0">
                    <li class="breadcrumb-item"><a href="javascript: void(0);">Estructura</a>
                    </li>
                    <li class="breadcrumb-item active">Grupos</li>
                    <li class="breadcrumb-item active">Editar</li>
                </ol>
            </div>

        </div>
    </div>
</div>
{{!-- /parametrizacion/validaciones/E{{id}} --}}
<div class="row">
    <div class="col-lg-12">
        <div class="card">
            <div class="card-body">
                <ul class="nav nav-pills nav-justified" role="tablist">
                    <li class="nav-item waves-effect waves-light">
                        <a class="nav-link active" data-bs-toggle="tab" href="#fcruces" role="tab">
                            <span class="d-block d-sm-none"><i class="fas fa-home"></i></span>
                            <span class="d-none d-sm-block">Editar Cruces Contables</span>
                        </a>
                    </li>
                    <li class="nav-item waves-effect waves-light">
                        <a class="nav-link" data-bs-toggle="tab" href="#formatos" role="tab">
                            <span class="d-block d-sm-none"><i class="far fa-user"></i></span>
                            <span class="d-none d-sm-block">Editar Cruce Formatos</span>
                        </a>
                    </li>
                </ul>
                <div class="tab-content p-3 text-muted">
                    <div class="tab-pane active" id="fcruces" role="tabpanel">
                        <div class="form-group row">
                            <h4 class="mb-sm-0 font-size-18">Cruces Contables</h4>
                            <br>
                            <p class="card-title-desc">Esta opción permite la visualización y gestión de las
                                validaciones creadas para cruces contables.
                            </p>
                            <div class="">
                                <a href="/parametrizacion/validaciones/E{{id}}"
                                    class="btn btn-success .btn-circle btn-sm mr-auto">
                                    <span class="icon text-white-50">
                                        <i class="mdi mdi-check-all"></i>
                                    </span>
                                    <span class="text">Nuevo</span>
                                </a>
                            </div>
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="card">
                                        <div class="card-body">
                                            <form class="user" action="/parametrizacion/editestructura/{{id}}"
                                                method="POST" id="formcamposCruces" name="formcamposCruces"
                                                autocomplete="off">
                                                {{#each lista_cruces_contables}}
                                                <div class="form-group row">

                                                    <div class="form-group  col-mb-0 col-sm-0 col-lg-0">
                                                        <input type="hidden" maxlength="200" id="id_campo{{m}}"
                                                            name="id_campo{{m}}" class="form-control" value={{id}}>
                                                    </div>
                                                    <div class="form-group col-mb-3 col-sm-6 col-lg-3">
                                                        <label for="grupo1"> Grupo</label>
                                                        <select id="grupo{{n}}" name="grupo{{n}}" class="form-select"
                                                            required
                                                            onchange="consultar_subgrupos(this.value, this.name, this.id)">
                                                            <option value={{id_grupo}}>{{grupo}}</option>
                                                            {{#each grupo1}}
                                                            <option value={{id}}>{{nombre}}</option>
                                                            {{/each}}
                                                        </select>
                                                    </div>
                                                    <div class="form-group  col-mb-3 col-sm-6 col-lg-3">
                                                        <label for="subgrupo1">Subgrupo</label>
                                                        <select id="subgrupo{{n}}" name="subgrupo{{n}}"
                                                            class="form-select" required>
                                                            <option value={{id_subgrupo}} selected>{{subgrupo}}
                                                            </option>
                                                            {{#each subgrupo1}}
                                                            <option value={{id}}>{{nombre}}</option>
                                                            {{/each}}
                                                        </select>
                                                    </div>
                                                    <div class="form-group  col-mb-3 col-sm-6 col-lg-3">
                                                        <label for="categoria1">Categoría</label>
                                                        <select id="categoria{{n}}" name="categoria{{n}}"
                                                            class="form-select" required
                                                            onchange="consultar_subcategoria(this.value, this.name, this.id)">
                                                            <option value={{id_categoria}}>{{categoria}}</option>
                                                            {{#each categoria1}}
                                                            <option value={{id}}>{{nombre}}</option>
                                                            {{/each}}
                                                        </select>
                                                    </div>
                                                    <div class="form-group  col-mb-3 col-sm-6 col-lg-3">
                                                        <label for="subcategoria1">subcategoría</label>
                                                        <select id="subcategoria{{n}}" name="subcategoria{{n}}"
                                                            class="form-select" required>
                                                            <option value={{id_subcategoria}} selected>
                                                                {{subcategoria}}
                                                            </option>
                                                            {{#each subcategoria1}}
                                                            <option value={{id}}>{{nombre}}</option>
                                                            {{/each}}
                                                        </select>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-mb-3 col-sm-3 col-lg-3">
                                                            <label for="email">Archivo de validación</label>
                                                            <select id="archivo_cruce{{n}}" name="archivo_cruce{{n}}"
                                                                class="form-select" required
                                                                onchange="activar_campos(this.value,this.name,this.id)">
                                                                <option value={{puc_libro}} selected>{{puc_libro}}
                                                                </option>

                                                                {{#each tipo_libro}}
                                                                <option value={{nombre}}>{{nombre}}</option>
                                                                {{/each}}
                                                            </select>
                                                        </div>
                                                        <div class="col-mb-2 col-sm-3  col-lg-2">
                                                            <label for="message">Número de cuenta </label>
                                                            <input type="text" {{disabled1}} maxlength="200"
                                                                id="cuenta_cruce{{n}}" name="cuenta_cruce{{n}}"
                                                                class="form-control" value="{{nro_cuenta}}">
                                                        </div>
                                                        <div class="col-mb-3 col-sm-3 col-lg-3">
                                                            <label for="email">Layout</label>
                                                            <select id="layout{{n}}" name="layout{{n}}"
                                                                class="form-select" required {{disabled}}>
                                                                <option value={{id_layout}} selected>{{layout}}</option>
                                                                {{#each layouts}}
                                                                <option value={{id}}>{{nombre}}</option>
                                                                {{/each}}
                                                            </select>
                                                        </div>
                                                        <br>
                                                        <div class="form-group  mb-3 col-lg-2 align-self-end">
                                                            <label for="message"></label>
                                                            <label for="message"></label>
                                                            <a class="btn btn-danger btn-sm"
                                                                href="/parametrizacion/editestructura/deleteContable/{{id}}"
                                                                onclick="return preguntarEliminar()">
                                                                <span
                                                                    class="btn btn-danger waves-effect waves-light btn-sm d-inline-block"
                                                                    tabindex="0" data-placement="top"
                                                                    title="Eliminar"><i class="fas fa-trash"
                                                                        data-toggle="tooltip"> </i>
                                                                </span>
                                                                <span class="text"> </span>
                                                            </a>
                                                        </div>
                                                        <br>
                                                        <hr>
                                                    </div>
                                                </div>
                                                {{/each}}
                                            </form>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="formatos" role="tabpanel">
                        <div class="form-group row">
                            <h4 class="mb-sm-0 font-size-18">Cruces Formatos</h4>
                            <br>
                            <p class="card-title-desc">Esta opción permite la visualización y gestión de las
                                validaciones creadas para cruces entre formatos.
                            </p>
                            <div class="">
                                <a href="/parametrizacion/validaciones/E{{id}}"
                                    class="btn btn-success .btn-circle btn-sm mr-auto">
                                    <span class="icon text-white-50">
                                        <i class="mdi mdi-check-all"></i>
                                    </span>
                                    <span class="text">Nuevo</span>
                                </a>
                            </div>
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="card">
                                        <div class="card-body">
                                            <form class="user" action="/parametrizacion/editestructura/{{id_formato}}"
                                                method="POST" id="formcamposFormatos" name="formcamposFormatos"
                                                autocomplete="off">
                                                {{#each lista_cruces}}
                                                <div class="form-group row">

                                                    <div class="form-group  col-mb-0 col-sm-0 col-lg-0">
                                                        <input type="hidden" maxlength="200" id="id_campo{{m}}"
                                                            name="id_campo{{m}}" class="form-control" value={{id}}>
                                                    </div>
                                                    <div class="form-group col-mb-3 col-sm-6 col-lg-3">
                                                        <label for="grupo1">{{id}} Grupo</label>
                                                        <select id="grupo{{m}}" name="grupo{{m}}" class="form-select"
                                                            required
                                                            onchange="consultar_subgrupos(this.value, this.name, this.id)">
                                                            <option value={{id_grupo}}>{{nombre_grupo}}</option>
                                                            {{#each grupo}}
                                                            <option value={{id}}>{{nombre}}</option>
                                                            {{/each}}
                                                        </select>
                                                    </div>
                                                    <div class="form-group  col-mb-3 col-sm-6 col-lg-3">
                                                        <label for="subgrupo1">Subgrupo</label>
                                                        <select id="subgrupo{{m}}" name="subgrupo{{m}}"
                                                            class="form-select" required>
                                                            <option value={{id_subgrupo}} selected>{{nombre_subgrupo}}
                                                            </option>
                                                            {{#each subgrupo}}
                                                            <option value={{id}}>{{nombre}}</option>
                                                            {{/each}}
                                                        </select>
                                                    </div>
                                                    <div class="form-group  col-mb-3 col-sm-6 col-lg-3">
                                                        <label for="categoria1">Categoría</label>
                                                        <select id="categoria{{m}}" name="categoria{{m}}"
                                                            class="form-select" required
                                                            onchange="consultar_subcategoria(this.value, this.name, this.id)">
                                                            <option value={{id_categoria}}>{{nombre_categoria}}</option>
                                                            {{#each categoria}}
                                                            <option value={{id}}>{{nombre}}</option>
                                                            {{/each}}
                                                        </select>
                                                    </div>
                                                    <div class="form-group  col-mb-3 col-sm-6 col-lg-3">
                                                        <label for="subcategoria1">subcategoría</label>
                                                        <select id="subcategoria{{m}}" name="subcategoria{{m}}"
                                                            class="form-select" required>
                                                            <option value={{id_subcategoria}} selected>
                                                                {{nombre_subcategoria}}
                                                            </option>
                                                            {{#each subcategoria}}
                                                            <option value={{id}}>{{nombre}}</option>
                                                            {{/each}}
                                                        </select>
                                                    </div>
                                                    <br>
                                                    <br>
                                                    <div class="form-group col-mb-3 col-sm-3 col-lg-3">
                                                        <label for="formatoI">Nombre del formato</label>
                                                        <select id="formatoI{{m}}" name="formatoI{{m}}"
                                                            class="form-select"
                                                            onchange="consultar_campos2(this.value, this.name, this.id)"
                                                            required>
                                                            <option value={{id_formato}}>{{nombre_formato}}</option>
                                                            {{#each lista_formatos}}
                                                            <option value="{{id}}">{{nombre}}</option>
                                                            {{/each}}
                                                        </select>
                                                    </div>
                                                    <div class="form-group col-mb-3 col-sm-6 col-lg-3">
                                                        <label for="grupoI">Grupo Cruce</label>
                                                        <select id="grupoI{{m}}" name="grupoI{{m}}" class="form-select"
                                                            required
                                                            onchange="consultar_subgruposI(this.value, this.name, this.id)">
                                                            <option value={{id_grupo_cruce}} selected>
                                                                {{nombre_grupo_cruce}}
                                                            </option>
                                                            {{#each grupo}}
                                                            <option value={{id}}>{{nombre}}</option>
                                                            {{/each}}
                                                        </select>
                                                    </div>
                                                    <div class="form-group col-mb-3 col-sm-6 col-lg-3">
                                                        <label for="subgrupoI">Subgrupo Cruce</label>
                                                        <select id="subgrupoI{{m}}" name="subgrupoI{{m}}"
                                                            class="form-select" required>
                                                            <option value={{id_subgrupo_cruce}} selected>
                                                                {{nombre_subgrupo_cruce}}
                                                            </option>
                                                        </select>
                                                    </div>
                                                    <div class="form-group col-mb-3 col-sm-6 col-lg-3">
                                                        <label for="categoriaI">Categoría Cruce</label>
                                                        <select id="categoriaI{{m}}" name="categoriaI{{m}}"
                                                            class="form-select" required
                                                            onchange="consultar_subcategoriaI(this.value, this.name, this.id)">
                                                            <option value={{id_categoria_cruce}} selected>
                                                                {{nombre_categoria_cruce}}
                                                            </option>

                                                            {{#each categoria}}
                                                            <option value={{id}}>{{nombre}}</option>
                                                            {{/each}}
                                                        </select>
                                                    </div>
                                                    <div class="form-group col-mb-3 col-sm-6 col-lg-3">
                                                        <label for="subcategoriaI">subcategoría Cruce</label>
                                                        <select id="subcategoriaI{{m}}" name="subcategoriaI{{m}}"
                                                            class="form-select" required>
                                                            <option value={{id_subcategoria_cruce}} selected>
                                                                {{nombre_subcategoria_cruce}}
                                                            </option>
                                                        </select>
                                                    </div>

                                                    <div class="form-group col-mb-2 col-sm-3 col-lg-2">
                                                        <label for="message">Umbral (%)</label>
                                                        <input type="text" maxlength="200" id="umbral_formatos{{m}}"
                                                            name="umbral_formatos{{m}}" class="form-control"
                                                            value={{umbral}} required>
                                                    </div>
                                                    <div class="form-group col-mb-3 col-sm-3 col-lg-3">
                                                        <label for="ciclo">Ciclo del reporte</label>
                                                        <select id="ciclo{{m}}" name="ciclo{{m}}" class="form-select"
                                                            required>
                                                            <option selected>{{ciclo}}</option>
                                                            <option>Actual</option>
                                                            <option>Mensual</option>
                                                            <option>Trimestral</option>
                                                            <option>Anual</option>
                                                        </select>
                                                    </div>
                                                    <div class="form-group  mb-3 col-lg-2 align-self-end">
                                                        <label for="message"></label>
                                                        <label for="message"></label>
                                                        <a class="btn btn-danger btn-sm"
                                                            href="/parametrizacion/editestructura/deleteFormato/{{id}}"
                                                            onclick="return preguntarEliminar()">
                                                            <span
                                                                class="btn btn-danger waves-effect waves-light btn-sm d-inline-block"
                                                                tabindex="0" data-placement="top" title="Eliminar"><i
                                                                    class="fas fa-trash" data-toggle="tooltip"> </i>
                                                            </span>
                                                            <span class="text"> </span>
                                                        </a>
                                                    </div>
                                                    <br>
                                                    <hr>
                                                </div>
                                                {{/each}}
                                                {{!-- <button id="btnEnviar" name="btnEnviar"
                                                    class="btn btn-primary btn-lg waves-effect waves-light ml-auto">Enviar
                                                    formulario</button> --}}
                                            </form>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="container">
                    <div class="row">
                        <div class="col-md-3 col-md-offset-2  align-self-end"></div>
                        <div class="col-md-3 col-md-offset-2"> </div>

                        <div class="col-md-3 align-self-end">
                            <button id="btnEnviar" name="btnEnviar" onclick="submitForms({{id}})"
                                class="btn btn-primary btn-lg waves-effect waves-light">Enviar
                                formulario</button>
                        </div>

                        {{!-- /parametrizacion/campos/232 --}}

                        <div class="col-md-3 align-self-end">
                            <a href="/parametrizacion/campos/{{id}}"
                                class="btn btn-success btn-lg waves-effect waves-light">Regresar
                                a la
                                lista
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
<script>
    function activar_campos(id, nombre_elemento, id_elemento) {

        let posicion = ""
        archivo_cruce0
        if (id_elemento.leng === 14) {
            posicion = nombre_elemento.slice(13, 14)
        } else {
            posicion = nombre_elemento.slice(13, 15)

        }

        if (id === "Layout") {
            document.getElementById("cuenta_cruce" + posicion).disabled = true;
            document.getElementById("layout" + posicion).disabled = false;

        } else {
            document.getElementById("cuenta_cruce" + posicion).disabled = false;
            document.getElementById("layout" + posicion).disabled = true;
            document.getElementById("layout" + posicion).selectedIndex = 0

        }


    }


    function consultar_subgrupos(id, nombre_elemento, id_elemento) {

        let longitud = nombre_elemento.length;

        if (longitud === 6) {
            posicion = id_elemento.slice(5, 6)
        } else {
            posicion = id_elemento.slice(5, 7)
        }
        console.log(posicion)
        $.ajax({
            url: '/parametrizacion/consultar/subgrupos',
            method: 'POST',
            data: {
                'array': JSON.stringify(id)
            },
            success: function (consulta_campo) {
                $("#subgrupo" + posicion).find('option').remove();
                $("#subgrupo" + posicion).append(`<option value="">Seleccione...</option>`)
                consulta_campo.consulta_campo.forEach(consulta_campo => {
                    $("#subgrupo" + posicion).append(`<option value="${consulta_campo.id}">${consulta_campo.nombre}</option>`)
                })
            }
        })
    }
    function consultar_subgruposI(id, nombre_elemento, id_elemento) {

        let longitud = nombre_elemento.length;

        if (longitud === 7) {
            posicion = id_elemento.slice(6, 7)
        } else {
            posicion = id_elemento.slice(6, 8)
        }
        console.log(posicion)
        $.ajax({
            url: '/parametrizacion/consultar/subgrupos',
            method: 'POST',
            data: {
                'array': JSON.stringify(id)
            },
            success: function (consulta_campo) {
                $("#subgrupoI" + posicion).find('option').remove();
                $("#subgrupoI" + posicion).append(`<option value="">Seleccione...</option>`)
                consulta_campo.consulta_campo.forEach(consulta_campo => {
                    $("#subgrupoI" + posicion).append(`<option value="${consulta_campo.id}">${consulta_campo.nombre}</option>`)
                })
            }
        })
    }
    function consultar_campos2(id, nombre_elemento, id_elemento) {
        let longitud = id_elemento.length;
        console.log(longitud)
        if (longitud === 9) {
            posicion = id_elemento.slice(8, 9)
        } else {
            posicion = id_elemento.slice(8, 10)
        }
        console.log(id_elemento, posicion);

        $.ajax({
            url: '/parametrizacion/consultar/festructura/campos',
            method: 'POST',
            data: {
                'array': JSON.stringify(id)
            },
            success: function (consulta_campo) {
                console.log("#grupoI" + posicion);
                $("#grupoI" + posicion).find('option').remove();
                $("#grupoI" + posicion).append(`<option value="">Seleccione...</option>`);
                consulta_campo.grupo.forEach(consulta_campo => {
                    $("#grupoI" + posicion).append(`<option value="${consulta_campo.id}">${consulta_campo.nombre}</option>`)
                })
                $("#subgrupoI" + posicion).find('option').remove();
                $("#subgrupoI" + posicion).append(`<option value="">Seleccione...</option>`);
                $("#categoriaI" + posicion).find('option').remove();
                $("#categoriaI" + posicion).append(`<option value="">Seleccione...</option>`);
                $("#subcategoriaI" + posicion).find('option').remove();
                $("#subcategoriaI" + posicion).append(`<option value="">Seleccione...</option>`);
                consulta_campo.categoria.forEach(consulta_campo => {
                    $("#categoriaI" + posicion).append(`<option value="${consulta_campo.id}">${consulta_campo.nombre}</option>`)
                })
            }
        })
    }
    function consultar_subcategoria(id, nombre_elemento, id_elemento) {
        console.log(nombre_elemento, id_elemento.length);

        let longitud = id_elemento.length;

        if (longitud === 10) {
            posicion = id_elemento.slice(9, 10)
        } else {
            posicion = id_elemento.slice(9, 11)
        }

        console.log(posicion, id_elemento)

        $.ajax({
            url: '/parametrizacion/consultar/subcategoria',
            method: 'POST',
            data: {
                'array': JSON.stringify(id)
            },
            success: function (consulta_campo) {
                $("#subcategoria" + posicion).find('option').remove();
                $("#subcategoria" + posicion).append(`<option value="">Seleccione...</option>`)
                consulta_campo.consulta_subcategoria.forEach(consulta_subcategoria => {
                    $("#subcategoria" + posicion).append(`<option value="${consulta_subcategoria.id}">${consulta_subcategoria.nombre}</option>`)
                })
            }
        })
    }
    function consultar_subcategoriaI(id, nombre_elemento, id_elemento) {
        console.log(nombre_elemento, id_elemento.length);

        let longitud = id_elemento.length;

        if (longitud === 11) {
            posicion = id_elemento.slice(10, 11)
        } else {
            posicion = id_elemento.slice(10, 12)
        }

        console.log(posicion, id_elemento)

        $.ajax({
            url: '/parametrizacion/consultar/subcategoria',
            method: 'POST',
            data: {
                'array': JSON.stringify(id)
            },
            success: function (consulta_campo) {
                $("#subcategoriaI" + posicion).find('option').remove();
                $("#subcategoriaI" + posicion).append(`<option value="">Seleccione...</option>`)
                consulta_campo.consulta_subcategoria.forEach(consulta_subcategoria => {
                    $("#subcategoriaI" + posicion).append(`<option value="${consulta_subcategoria.id}">${consulta_subcategoria.nombre}</option>`)
                })
            }
        })
    }
    function submitForms(info_campo) {
        let route = '/parametrizacion/editestructura/' + info_campo
        $.ajax({
            url: route,
            method: 'POST',
            data: {
                'cruces': JSON.stringify($("#formcamposCruces").serializeArray()),
                'formatos': JSON.stringify($("#formcamposFormatos").serializeArray()),

            },
            success: function () {
            }
        })
        window.location = "/parametrizacion/campos/" + info_campo;
    }
    function preguntarEliminar() {
        var respuesta = confirm('¿Esta seguro que desea eliminar el registro?');
        if (respuesta == true) {
            return true;
        }
        else {
            return false;
        }
    };
</script>